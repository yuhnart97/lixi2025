<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lộc Năm Mới 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.10.2/dist/index.umd.js"></script>
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Firebase configuration (Thay thế bằng config của bạn)
        const firebaseConfig = {
            apiKey: "AIzaSyCJTO4pEuUJeqPgDPhYSH0w-SAq7HwlHQw",
            authDomain: "lixi2025-b26ce.firebaseapp.com",
            projectId: "lixi2025-b26ce",
            storageBucket: "lixi2025-b26ce.firebasestorage.app",
            messagingSenderId: "307654549528",
            appId: "1:307654549528:web:bdaa334c9df437f63ba36d",
            measurementId: "G-FYJELRRLHP"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        window.receiveLuckyMoney = async function () {
            const name = document.getElementById("name").value.trim();
            if (!name) {
                alert("Nhập tên của bạn!");
                return;
            }
            
            // Kiểm tra xem tên đã nhận lì xì chưa
            const usersRef = collection(db, "users");
            const q = query(usersRef, where("name", "==", name));
            const querySnapshot = await getDocs(q);
            
            if (!querySnapshot.empty) {
                alert("U là trời! Bạn đã nhận lì xì rồi mà! Chúc bạn năm mới vui vẻ!");
                return;
            }
            
            const amounts = [100000, 200000, 300000, 400000, 500000, 600000, 700000, 800000, 900000, 1000000];
            let luckyMoney = amounts[Math.floor(Math.random() * amounts.length)];
            
            const greetings = [
                "Chúc bạn năm mới an khang thịnh vượng!",
                "Chúc mừng năm mới! Chúc bạn sức khỏe và may mắn!",
                "Năm mới phát tài, vạn sự như ý!",
                "Chúc bạn tình đầy túi, tình đầy tim",
                "Chúc bạn có một năm đầy may mắn và bình an!"
            ];
            const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];

            // Hiển thị số tiền thay đổi liên tục trong popup
            const popup = document.getElementById("popup");
            let interval = setInterval(function() {
                luckyMoney = amounts[Math.floor(Math.random() * amounts.length)];
                popup.innerHTML = `<h3>${randomGreeting}</h3><p>${name}, bạn nhận được <strong>${luckyMoney.toLocaleString()} đồng</strong>!</p>`;
                popup.style.display = "block";
            }, 100); // Hiển thị số tiền thay đổi mỗi 100ms

            // Lưu thông tin vào Firestore sau khi chọn xong số tiền
            setTimeout(async () => {
                clearInterval(interval); // Dừng việc thay đổi số tiền
                await addDoc(collection(db, "users"), {
                    name: name,
                    luckyMoney: luckyMoney,
                    timestamp: new Date()
                });

                // Tiến hành hiển thị thông báo cuối cùng
                popup.innerHTML = `<h3>${randomGreeting}</h3><p>${name}, bạn nhận được <strong>${luckyMoney.toLocaleString()} đồng</strong>!</p>`;
                
                const fireworksContainer = document.getElementById("fireworks-container");
                fireworksContainer.style.display = "block";
                
                const fireworks = new Fireworks.default(fireworksContainer, { 
                    autoresize: true, 
                    opacity: 0.9, 
                    acceleration: 1.05,
                    friction: 0.97,
                    gravity: 1.5,
                    particles: 150,
                    trace: 3,
                    explosion: 5,
                    intensity: 30,
                    flickering: 50,
                    lineStyle: 'round',
                    hue: { min: 0, max: 360 },
                    delay: { min: 30, max: 60 }
                });
                fireworks.start();
                
                setTimeout(() => {
                    fireworks.stop();
                    fireworksContainer.style.display = "none";
                    popup.style.display = "none";
                }, 5000); // Hiển thị 5 giây
            }, 3000); // Dừng sau 3 giây
        }

        // Kiểm tra nếu thiết bị là di động và thay đổi background
        function isMobileDevice() {
            return /Mobi|Android/i.test(navigator.userAgent);
        }

        window.onload = function() {
            if (isMobileDevice()) {
                document.body.style.backgroundImage = "url('https://thammylinhanh.vn/wp-content/uploads/2024/12/hinh-anh-dep-nam-2025.jpg')";
                document.body.style.backgroundSize = "cover"; // Đảm bảo hình ảnh nền phủ hết màn hình
                document.body.style.backgroundPosition = "center"; // Căn giữa hình nền
            }
        };
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: url('https://cdn-media.sforum.vn/storage/app/media/ctv_seo10/background-tet-84.jpg') no-repeat center center fixed;
            background-size: cover;
            padding: 20px;
        }
        .container {
            max-width: 400px;
            margin: auto;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            font-family: 'Brush Script MT', cursive;
            font-size: 28px;
            color: red;
            font-weight: bold;
        }
	input {
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
		}
        input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            background: red;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 1000;
        }
        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Lộc Năm Mới 2025</h2>
        <input type="text" id="name" placeholder="Ai là người may mắn :))" required>
        <button onclick="receiveLuckyMoney()">Nhận Lì Xì</button>
    </div>
    
    <div id="popup" class="popup"></div>
    <div id="fireworks-container"></div>
</body>
</html>
